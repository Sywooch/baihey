<ion-content>
  正在跳转支付...
</ion-content>
<script type="text/javascript">
    function onBridgeReady() {
        WeixinJSBridge.invoke(
                'getBrandWCPayRequest', {!$param},
        function (res) {
            ajaxPost('http://wechat.baihey.com/wap/charge/order-query',{out_trade_no:{!$orderId}},function success(res){
                alert(res.data);
                alert(res.data.return_code);
            })
            window.location.href = 'http://wechat.baihey.com/wap/site/main#/charge_order?orderId={!$orderId}';
        }
    );
    }
    if (typeof WeixinJSBridge == "undefined") {
        if (document.addEventListener) {
            document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);
        } else if (document.attachEvent) {
            document.attachEvent('WeixinJSBridgeReady', onBridgeReady);
            document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);
        }
    } else {
        onBridgeReady();
    }

    // ajax 对象
    function ajaxObject() {
        var xmlHttp;
        try {
            // Firefox, Opera 8.0+, Safari
            xmlHttp = new XMLHttpRequest();
        }
        catch (e) {
            // Internet Explorer
            try {
                xmlHttp = new ActiveXObject("Msxml2.XMLHTTP");
            } catch (e) {
                try {
                    xmlHttp = new ActiveXObject("Microsoft.XMLHTTP");
                } catch (e) {
                    alert("您的浏览器不支持AJAX！");
                    return false;
                }
            }
        }
        return xmlHttp;
    }

    // ajax post请求：
    function ajaxPost ( url , data , fnSucceed , fnFail , fnLoading ) {
        var ajax = ajaxObject();
        ajax.open( "post" , url , true );
        ajax.setRequestHeader( "Content-Type" , "application/x-www-form-urlencoded" );
        ajax.onreadystatechange = function () {
            if( ajax.readyState == 4 ) {
                if( ajax.status == 200 ) {
                    fnSucceed( ajax.responseText );
                }
                else {
                    fnFail( "HTTP请求错误！错误码："+ajax.status );
                }
            }
            else {
                fnLoading();
            }
        }
        ajax.send( data );

    }
</script>