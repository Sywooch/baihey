define(["app/module","app/directive/directiveApi","app/service/serviceApi"],function(e){return e.controller("User.register",["app.serviceApi","$scope","$ionicPopup","$ionicLoading","$interval","$location",function(e,t,r,s,a,i){function o(){return t.User.sex?ar.validateMobile(t.User.mobile)?!0:(ar.saveDataAlert(r,"请输入正确的手机号码"),!1):(ar.saveDataAlert(r,"请选择您的性别"),!1)}t.User={},t.codeTitle="获取验证码",document.body.scrollHeight>document.documentElement.clientHeight?t.winHeight={height:document.body.scrollHeight+"px"}:t.winHeight={height:document.documentElement.clientHeight+"px"},t.sexToggle=function(e,r){r.stopPropagation(),t.User.sex=e},t.getCode=function(){o(),e.getMobileIsExist(t.User.mobile).success(function(s){if(s.status<1)return ar.saveDataAlert(r,"该手机号码已存在"),!1;var i=90,o=a(function(){t.codeTitle="重新获取("+i+")"},1e3,90);o.then(function(){t.codeTitle="获取验证码",a.cancel(o)},function(){ar.saveDataAlert(r,"倒计时出错")},function(){i-=1}),e.sendCodeMsg(t.User.mobile).success(function(e){e.status<1&&(a.cancel(o),ar.saveDataAlert(r,e.msg))})})},t.register=function(){if(!o())return!1;s.show({template:"注册中..."});var a=e.save("/wap/user/register",t.User);a.success(function(e){if(s.hide(),1==e.status){ar.setStorage("userInfo",e.data);var a=r.alert({title:"重要提示",template:"您的初始密码为："+ar.getPassByPhone(t.User.mobile)+"，请及时前往个人中心修改您的密码。"});a.then(function(e){top.location.href="/wap/site/main#/index"})}else ar.saveDataAlert(r,e.msg)}).error(function(){s.hide(),ar.saveDataAlert(r,"网络连接错误，请重试！")})}}]),e.controller("User.login",["app.serviceApi","$scope","$ionicPopup","$location","$ionicLoading",function(e,t,r,s,a){t.User={},t.login=function(){t.validateFrom()&&(a.show({template:"登录中..."}),e.save("/wap/user/login",t.User).success(function(e){a.hide(),e.status?top.location.href="/wap/site/main#/index":ar.saveDataAlert(r,e.msg)}).error(function(){a.hide(),ar.saveDataAlert(r,"网络连接错误，请重试")}))},t.validateFrom=function(){return t.User.username?t.User.password?!0:(ar.saveDataAlert(r,"请输入您的密码"),!1):(ar.saveDataAlert(r,"请输入您的手机号码或ID"),!1)}}]),e.controller("User.forgetpass",["app.serviceApi","$scope","$ionicPopup",function(e,t,r){t.User={},t.User.codeBtn="获取验证码",t.User.getCode=function(){return t.User.codeSwitch=!0,t.User.codeCls=!0,t.User.max_time=60,t.User.timer=setInterval(t.User.startTime,1e3),setTimeout(t.User.endTime,1e3*t.User.max_time),ar.validateMobile(t.User.mobile)?void e.sendCodeMsg(t.User.mobile).success(function(e){return e.status?void 0:(ar.saveDataAlert(r,"短信发送失败，请稍后重试。"),!1)}):(ar.saveDataAlert(r,"手机号码格式不正确"),!1)},t.User.startTime=function(){t.User.max_time-=1,t.User.codeBtn="重新发送"+t.User.max_time,t.$apply()},t.User.endTime=function(){t.User.codeSwitch=!1,t.User.codeCls=!1,t.User.codeBtn="获取验证码",clearInterval(t.User.timer),t.$apply()},t.User.next=function(){window.location.href="/wap/user/setpass?mobile="+t.User.mobile,e.validateCode(t.User.code).success(function(e){return e.status?void(window.location.href="/wap/user/setpass?mobile="+t.User.mobile):(ar.saveDataAlert(r,"验证码不正确"),!1)})}}]),e.controller("User.setpass",["app.serviceApi","$scope","$ionicPopup",function(e,t,r){t.User={},t.mobile=ar.getQueryString("mobile"),t.User.setpass=function(){if(!ar.validatePass(t.User.password))return ar.saveDataAlert(r,"密码不能少于6位字符"),!1;if(t.User.password!=t.User.repassword)return ar.saveDataAlert(r,"两次输入的密码不一致"),!1;var s=[];s.password=t.User.password,s.phone=t.mobile,e.save("/wap/user/forgot-password",s).success(function(e){e.status?window.location.href="/wap/user/login":ar.saveDataAlert(r,"设置密码失败")}).error(function(){ar.saveDataAlert(r,"网络错误，请稍候再试")})}}]),e});