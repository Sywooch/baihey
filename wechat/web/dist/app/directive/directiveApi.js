define(["app/module"],function(e){e.directive("config",function(){return{restrict:"E",link:function(e,t){console.log(t.html())}}}),e.directive("msdElastic",["$timeout","$window",function(e,t){"use strict";return{require:"ngModel",restrict:"A, C",link:function(n,i,o,r){function a(){var e=h;d=c,b=getComputedStyle(c),angular.forEach(P,function(t){e+=t+":"+b.getPropertyValue(t)+";"}),y.setAttribute("style",e)}function l(){var t,i,o,r,l;d!==c&&a(),p||(p=!0,y.value=c.value+f,y.style.overflowY=c.style.overflowY,t=""===c.style.height?"auto":parseInt(c.style.height,10),i=getComputedStyle(c).getPropertyValue("width"),"px"===i.substr(i.length-2,2)&&(r=parseInt(i,10)-$.width,y.style.width=r+"px"),o=y.scrollHeight,o>V?(o=V,l="scroll"):I>o&&(o=I),o+=$.height,c.style.overflowY=l||"hidden",t!==o&&(n.$emit("elastic:resize",u,t,o),c.style.height=o+"px"),n.$emit("taResize",u),e(function(){p=!1},1,!1))}function s(){p=!1,l()}var c=i[0],u=i;if("TEXTAREA"===c.nodeName&&t.getComputedStyle){u.css({overflow:"hidden","overflow-y":"hidden","word-wrap":"break-word"});var g=c.value;c.value="",c.value=g;var d,p,f=o.msdElastic?o.msdElastic.replace(/\\n/g,"\n"):"",m=angular.element(t),h="position: absolute; top: -999px; right: auto; bottom: auto;left: 0; overflow: hidden; -webkit-box-sizing: content-box;-moz-box-sizing: content-box; box-sizing: content-box;min-height: 0 !important; height: 0 !important; padding: 0;word-wrap: break-word; border: 0;",v=angular.element('<textarea aria-hidden="true" tabindex="-1" style="'+h+'"/>').data("elastic",!0),y=v[0],b=getComputedStyle(c),w=b.getPropertyValue("resize"),x="border-box"===b.getPropertyValue("box-sizing")||"border-box"===b.getPropertyValue("-moz-box-sizing")||"border-box"===b.getPropertyValue("-webkit-box-sizing"),$=x?{width:parseInt(b.getPropertyValue("border-right-width"),10)+parseInt(b.getPropertyValue("padding-right"),10)+parseInt(b.getPropertyValue("padding-left"),10)+parseInt(b.getPropertyValue("border-left-width"),10),height:parseInt(b.getPropertyValue("border-top-width"),10)+parseInt(b.getPropertyValue("padding-top"),10)+parseInt(b.getPropertyValue("padding-bottom"),10)+parseInt(b.getPropertyValue("border-bottom-width"),10)}:{width:0,height:0},z=parseInt(b.getPropertyValue("min-height"),10),k=parseInt(b.getPropertyValue("height"),10),I=Math.max(z,k)-$.height,V=parseInt(b.getPropertyValue("max-height"),10),P=["font-family","font-size","font-weight","font-style","letter-spacing","line-height","text-transform","word-spacing","text-indent"];u.data("elastic")||(V=V&&V>0?V:9e4,y.parentNode!==document.body&&angular.element(document.body).append(y),u.css({resize:"none"===w||"vertical"===w?"none":"horizontal"}).data("elastic",!0),"onpropertychange"in c&&"oninput"in c?c.oninput=c.onkeyup=l:c.oninput=l,m.bind("resize",s),n.$watch(function(){return r.$modelValue},function(e){s()}),n.$on("elastic:adjust",function(){a(),s()}),e(l,0,!1),n.$on("$destroy",function(){v.remove(),m.unbind("resize",s)}))}}}}]),e.directive("resizeFootBar",["$ionicScrollDelegate",function(e){return{replace:!1,link:function(t,n,i,o){t.$on("taResize",function(t,i){if(i){var o=document.body.querySelector("#message-detail-content"),r=e.$getByHandle("messageDetailsScroll"),a=i[0].offsetHeight,l=a+10;l=l>44?l:44,n[0].style.height=l+"px",o.style.bottom=l+"px",r.scrollBottom()}})}}}]),e.directive("showMulti",["$animate",function(e){return{replace:!1,link:function(t,n,i,o){var r=n.parent().parent().parent("#msg_footer_bar"),a=n.parent().parent().parent().next("#multi_con");n.bind("click",function(){e.animate(r,{bottom:a[0].offsetHeight+"px"}),e.animate(a,{bottom:"0"})})}}}]),e.directive("timer",function(e){function t(t,n,i){var o=e(function(){var e=new Date,t=1e3*i.timer-e.getTime(),o=Math.floor(t/1e3/60/60/24),r=Math.floor(t/1e3/60/60%24),a=Math.floor(t/1e3/60%60),l=Math.floor(t/1e3%60);n.text(o+"天"+r+"时"+a+"分"+l+"秒")},1e3);o.then(function(){},function(){}),t.$on("$destroy",function(t){e.cancel(o)})}return{link:t,scope:!1}}),e.directive("ionSticky",["$ionicPosition","$compile","$timeout",function(e,t,n){return{restrict:"A",require:"^$ionicScroll",link:function(n,i,o,r){var a,l=angular.element(r.element),s=function(e,t){for(var n=e.getElementsByTagName("textarea"),i=t.getElementsByTagName("textarea"),o=e.getElementsByTagName("select"),r=t.getElementsByTagName("select"),a=0,l=n.length;l>a;++a)i[a].value=n[a].value;for(var a=0,l=o.length;l>a;++a)r[a].value=o[a].value},c=function(i){a=i.clone().css({position:"absolute",top:e.position(l).top+"px",left:0,right:0}),o.ionStickyClass=o.ionStickyClass?o.ionStickyClass:"assertive",s(i[0],a[0]),a[0].className+=" "+o.ionStickyClass,a.removeAttr("ng-repeat-start").removeAttr("ng-if"),l.parent().append(a),t(a)(n)},u=function(){a&&a.remove(),a=null};n.$on("$destroy",function(){u(),angular.element(r.element).off("scroll")});var g,d=o.minHeight?o.minHeight:0,p=ionic.throttle(function(){for(var t=null,n=[],o=i[0].getElementsByClassName("item-divider"),r=0;r<o.length;++r)n.push(angular.element(o[r]));for(var r=0;r<n.length;++r)if(e.offset(n[r]).top-n[r].prop("offsetHeight")-d<0&&(r===n.length-1||e.offset(n[r+1]).top-(n[r].prop("offsetHeight")+n[r+1].prop("offsetHeight"))-d>0)){t=n[r][0];break}g!=t&&(u(),g=t,null!=t&&c(angular.element(t)))},200);l.on("scroll",function(e){p()})}}}]),e.directive("clickLike",["$animate","$timeout",function(e,t){return function(e,n,i){n.on("click",function(){n.find("i").next().addClass("anm"),t(function(){n.find("i").next().removeClass("anm")},400)})}}]),e.directive("changeTitle",["$timeout",function(e){return function(t,n,i){function o(t){var n=document.body;document.title=t;var i=angular.element("<iframe style='display:none;' src='/favicon.ico'></iframe>");i.on("load",function(){e(function(){i.off("load").remove()},0)}),angular.element(n).append(i)}o(i.receiveId>9999?i.changeTitle:i.realName),t.$on("$ionicView.beforeLeave",function(){o("嘉瑞百合缘")})}}]),e.directive("lazyload",function(){return{restrict:"EA",replace:!1,link:function(e,t,n){var i=new Image;return i.src=n.lazyload,i.complete?void t.prop("src",i.src):void(i.onload=function(){t.prop("src",i.src)})}}}),e.directive("getImgSize",function(){return{restrict:"EA",link:function(e,t,n){var i=n.getImgSize.replace("thumb","picture");if(i.split(".")[0].split("_")[2])t.attr("data-size",i.split(".")[0].split("_")[1]+"x"+i.split(".")[0].split("_")[2]);else{var o=new Image;o.src=n.getImgSize,o.complete?t.attr("data-size",o.width+"x"+o.height):o.onload=function(){t.attr("data-size",o.width+"x"+o.height),o.onload=null}}}}}),e.directive("ngThumb",["$window",function(e){var t={support:!(!e.FileReader||!e.CanvasRenderingContext2D),isFile:function(t){return angular.isObject(t)&&t instanceof e.File},isImage:function(e){var t="|"+e.type.slice(e.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(t)}};return{restrict:"A",template:"<img />",link:function(e,n,i){function o(e){var t=new Image;t.src=e.target.result,t.complete?a.attr("src",e.target.result):t.onload=function(){a.attr("src",e.target.result),t.onload=null}}if(t.support){var r=e.$eval(i.ngThumb);if(t.isFile(r.file)&&t.isImage(r.file)){var a=n.find("img"),l=new FileReader;l.onload=o,l.readAsDataURL(r.file)}}}}}])});